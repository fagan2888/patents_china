import numpy as np
import pandas as pd
from glob import glob

cols_basic = {
	'year': 'year',
	'id': 'firmid',
	'UBI_1': 'taxid',
	'UBI_3': 'loccode',
	'UBI_5_Y': 'startyear',
	'UBI_5_M': 'startmonth',
	'UBI_7_a': 'industry_a',
	'UBI_7_b': 'industry_b',
	'UBI_8': 'regtype'
}

cols_goods = {
	'year': 'year',
	'id': 'firmid',
	'UGS_0_1': 'code',
	'UGS_42': 'sales_net',
	'UGS_43': 'cost_oper',
	'UGS_8': 'sales_va',
	'UGS_9': 'sales_nova',
	'UGS_10': 'sales_exp'
}

cols_taxes = {
	'year': 'year',
	'id': 'firmid',
	'UTF_M_14': 'ee',
	'UTF_M_25': 'profit_total_1',
	'UTF_L_13': 'profit_total_2',
	'UTF_M_27': 'profit_net',
	'UTF_M_2': 'income_main',
	'UTF_M_3': 'income_other',
	'UTF_L_1': 'income_oper',
	'UTF_Q_11': 'employees_start',
	'UTF_Q_12': 'employees_end',
	'UTF_Q_13': 'employees',
	'UTF_Q_14': 'output_value',
	'UTF_N_1': 'asset_start',
	'UTF_N_9': 'asset_end'
}

industry = {
	'1120': '790',
	'1110': '690',
	'1200': '1100',
	'1830': '1751',
	'1820': '1761',
	'1953': '3081',
	'1954': '2960',
	'1951': '1820',
	'2436': '4216',
	'2437': '4217',
	'2434': '4214',
	'2431': '4211',
	'2435': '4215',
	'2433': '4213',
	'2439': '4219',
	'2438': '4218',
	'2432': '4212',
	'2926': '3060',
	'2928': '3070',
	'2924': '3040',
	'2927': '3082',
	'2922': '3020',
	'2925': '3050',
	'2921': '3010',
	'2923': '3030',
	'2929': '3090',
	'3035': '3135',
	'3059': '3149',
	'3081': '3161',
	'3062': '3148',
	'3052': '3143',
	'3032': '3132',
	'3057': '4221',
	'3012': '3112',
	'3034': '3134',
	'3061': '3147',
	'3099': '3199',
	'3079': '3159',
	'3024': '3124',
	'3055': '3145',
	'3053': '3144',
	'3049': '3141',
	'3023': '3123',
	'3021': '3121',
	'3039': '3139',
	'3033': '3133',
	'3011': '3111',
	'3071': '3151',
	'3091': '3191',
	'3031': '3131',
	'3051': '3142',
	'3029': '3129',
	'3041': '3141',
	'3082': '3162',
	'3089': '3169',
	'3022': '3122',
	'3056': '3146',
	'3073': '3153',
	'3072': '3152',
	'3054': '3145',
	'3140': '3230',
	'3120': '3220',
	'3110': '3210',
	'3150': '3240',
	'3130': '3591',
	'3269': '3351',
	'3211': '3311',
	'3239': '3339',
	'3261': '3351',
	'3264': '3353',
	'3214': '3314',
	'3217': '3317',
	'3240': '3340',
	'3262': '3351',
	'3263': '3352',
	'3222': '3322',
	'3232': '3332',
	'3231': '3331',
	'3250': '3319',
	'3213': '3313',
	'3221': '3321',
	'3215': '3315',
	'3212': '3312',
	'3229': '3329',
	'3216': '3316',
	'3219': '3319',
	'3371': '3471',
	'3322': '3422',
	'3399': '3491',
	'3383': '3481',
	'3321': '3421',
	'3333': '3433',
	'3373': '3472',
	'3331': '3431',
	'3360': '3460',
	'3351': '3451',
	'3392': '3792',
	'3332': '3432',
	'3382': '3482',
	'3311': '3411',
	'3359': '3459',
	'3352': '3452',
	'3323': '3423',
	'3381': '3481',
	'3329': '3429',
	'3312': '3412',
	'3324': '3424',
	'3353': '3453',
	'3372': '3452',
	'3391': '3592',
	'3379': '3479',
	'3340': '3440',
	'3389': '3489',
	'3489': '3589',
	'3441': '3541',
	'3462': '3571',
	'3433': '3530',
	'3421': '3521',
	'3435': '3530',
	'3464': '3573',
	'3413': '3513',
	'3482': '3582',
	'3461': '3560',
	'3471': '4151',
	'3451': '3551',
	'3466': '3575',
	'3442': '3542',
	'3414': '3514',
	'3481': '3581',
	'3444': '3544',
	'3467': '3577',
	'3484': '3583',
	'3479': '4159',
	'3473': '4153',
	'3434': '3530',
	'3423': '3523',
	'3459': '3552',
	'3465': '3574',
	'3483': '3582',
	'3432': '3530',
	'3468': '3576',
	'3419': '3519',
	'3490': '3579',
	'3472': '4152',
	'3475': '4155',
	'3429': '3529',
	'3431': '3530',
	'3443': '3543',
	'3412': '3512',
	'3424': '3524',
	'3439': '3530',
	'3425': '3525',
	'3474': '4154',
	'3463': '3572',
	'3411': '3511',
	'3415': '3519',
	'3452': '3552',
	'3422': '3522',
	'3581': '3681',
	'3541': '3641',
	'3514': '3612',
	'3534': '3633',
	'3542': '3642',
	'3523': '3623',
	'3583': '3683',
	'3549': '3649',
	'3575': '3675',
	'3584': '3684',
	'3554': '3659',
	'3524': '3624',
	'3552': '3652',
	'3546': '3646',
	'3551': '3651',
	'3513': '3613',
	'3595': '3695',
	'3522': '3622',
	'3543': '3643',
	'3572': '3672',
	'3545': '3645',
	'3562': '3662',
	'3533': '3631',
	'3516': '3615',
	'3512': '3612',
	'3586': '3686',
	'3561': '3661',
	'3544': '3644',
	'3577': '3679',
	'3511': '3611',
	'3576': '3676',
	'3589': '3689',
	'3553': '3653',
	'3531': '3631',
	'3597': '3697',
	'3532': '3632',
	'3596': '3696',
	'3579': '3679',
	'3521': '3621',
	'3515': '3614',
	'3593': '3693',
	'3571': '3671',
	'3582': '3682',
	'3591': '3691',
	'3529': '3629',
	'3525': '3625',
	'3585': '3685',
	'3599': '3699',
	'3592': '3692',
	'3573': '3673',
	'3574': '3674',
	'3594': '3694',
	'3620': '3722',
	'3650': '3724',
	'3660': '3725',
	'3610': '3721',
	'3630': '3721',
	'3640': '3723',
	'3743': '3669',
	'3869': '3969',
	'3859': '3959',
	'3833': '3933',
	'3879': '3979',
	'3812': '3912',
	'3855': '3955',
	'3831': '3931',
	'3871': '3971',
	'3811': '3911',
	'3891': '3696',
	'3825': '3929',
	'3824': '3924',
	'3832': '3932',
	'3822': '3922',
	'3829': '3929',
	'3899': '3999',
	'3856': '3956',
	'3823': '3923',
	'3841': '3940',
	'3851': '3951',
	'3872': '3972',
	'3861': '3961',
	'3857': '3957',
	'3852': '3952',
	'3819': '3919',
	'3821': '3921',
	'3842': '3940',
	'3839': '3939',
	'3849': '3940',
	'3853': '3953',
	'3854': '3954',
	'3969': '4059',
	'3962': '4052',
	'3972': '4062',
	'3952': '4072',
	'3931': '4031',
	'3951': '4071',
	'3913': '4043',
	'3940': '4020',
	'3922': '4013',
	'3953': '4071',
	'3961': '4051',
	'3971': '4061',
	'3990': '4090',
	'3939': '4039',
	'3911': '4041',
	'3919': '4042',
	'3963': '4053',
	'3921': '4011',
	'3912': '4043',
	'3932': '4032',
	'4024': '4124',
	'4019': '4119',
	'4041': '4141',
	'4022': '4122',
	'4028': '4128',
	'4015': '4115',
	'4025': '4125',
	'4030': '4130',
	'4012': '4112',
	'4042': '4142',
	'4029': '4129',
	'4021': '4121',
	'4014': '4114',
	'4011': '4111',
	'4027': '4127',
	'4090': '4190',
	'4023': '4123',
	'4026': '4126',
	'4013': '4113',
	'4119': '4229',
	'4190': '4290',
	'4111': '4222',
	'4120': '4230',
	'4130': '4240',
	'4220': '4320',
	'4210': '4310',
	'4320': '3583',
	'4349': '3799',
	'4342': '3753',
	'4343': '3761',
	'4390': '3583',
	'4330': '3679',
	'4341': '3719',
	'4350': '3999',
	'4360': '4190',
	'4310': '3411',
	'4890': '4729',
	'4822': '4722',
	'4852': '4724',
	'4821': '4722',
	'4823': '4722',
	'4851': '4724',
	'4813': '4721',
	'4811': '4721',
	'4830': '4722',
	'4819': '4721',
	'4812': '4721',
	'4840': '4723',
	'4990': '4800',
	'4910': '4800',
	'4920': '4800',
	'5010': '4900',
	'5168': '6368',
	'5176': '6373',
	'5199': '6399',
	'5169': '6369',
	'5146': '6346',
	'5112': '6312',
	'5136': '6339',
	'5135': '6334',
	'5142': '6342',
	'5121': '6321',
	'5123': '6323',
	'5165': '6365',
	'5181': '6380',
	'5122': '6322',
	'5132': '6332',
	'5131': '6331',
	'5189': '6380',
	'5167': '6367',
	'5162': '6362',
	'5134': '6335',
	'5116': '6314',
	'5153': '6353',
	'5115': '6319',
	'5191': '6391',
	'5166': '6366',
	'5114': '6313',
	'5177': '6375',
	'5152': '6352',
	'5145': '6345',
	'5124': '6324',
	'5133': '6333',
	'5151': '6351',
	'5141': '6341',
	'5137': '6374',
	'5125': '6325',
	'5179': '6379',
	'5172': '6372',
	'5111': '6311',
	'5119': '6319',
	'5163': '6363',
	'5143': '6343',
	'5149': '6349',
	'5178': '6376',
	'5139': '6339',
	'5126': '6329',
	'5113': '6312',
	'5129': '6329',
	'5182': '6380',
	'5171': '6371',
	'5127': '6326',
	'5174': '6372',
	'5128': '6327',
	'5164': '6364',
	'5175': '6373',
	'5144': '6344',
	'5161': '6361',
	'5173': '6372',
	'5284': '6583',
	'5297': '6593',
	'5247': '6549',
	'5282': '6539',
	'5221': '6521',
	'5242': '6542',
	'5289': '6589',
	'5272': '6571',
	'5291': '6591',
	'5226': '6525',
	'5246': '6547',
	'5252': '6552',
	'5236': '6539',
	'5295': '6592',
	'5261': '6561',
	'5212': '6512',
	'5222': '6522',
	'5239': '6539',
	'5283': '6582',
	'5296': '6595',
	'5294': '6592',
	'5299': '6599',
	'5237': '6539',
	'5274': '6573',
	'5287': '6589',
	'5285': '6589',
	'5243': '6543',
	'5244': '6545',
	'5263': '6563',
	'5231': '6531',
	'5227': '6526',
	'5262': '6562',
	'5219': '6519',
	'5225': '6529',
	'5229': '6529',
	'5245': '6546',
	'5249': '6549',
	'5264': '6564',
	'5281': '6581',
	'5292': '6591',
	'5273': '6572',
	'5235': '6534',
	'5232': '6532',
	'5241': '6541',
	'5251': '6551',
	'5223': '6523',
	'5238': '6539',
	'5224': '6524',
	'5293': '6591',
	'5279': '6579',
	'5271': '6571',
	'5286': '6589',
	'5234': '6535',
	'5233': '6533',
	'5248': '6548',
	'5211': '6511',
	'5320': '5120',
	'5331': '5131',
	'5310': '5110',
	'5339': '5139',
	'5332': '5132',
	'5413': '5330',
	'5412': '5320',
	'5449': '5239',
	'5411': '5310',
	'5420': '5210',
	'5441': '5231',
	'5442': '5232',
	'5419': '5390',
	'5430': '5220',
	'5532': '5432',
	'5512': '5413',
	'5531': '5431',
	'5523': '5423',
	'5539': '5439',
	'5522': '5422',
	'5513': '5340',
	'5511': '5411',
	'5521': '5421',
	'5612': '5512',
	'5632': '5532',
	'5620': '5520',
	'5639': '5539',
	'5611': '5511',
	'5631': '5531',
	'5700': '5600',
	'5829': '5720',
	'5810': '5710',
	'5821': '5720',
	'5822': '5720',
	'5911': '5810',
	'5919': '5810',
	'5990': '5890',
	'5912': '5810',
	'6010': '5910',
	'6020': '5910',
	'6120': '6620',
	'6110': '6610',
	'6190': '6690',
	'6299': '6790',
	'6291': '6790',
	'6231': '6730',
	'6210': '6710',
	'6233': '6730',
	'6239': '6730',
	'6232': '6730',
	'6292': '6790',
	'6220': '6720',
	'6321': '6031',
	'6330': '6040',
	'6311': '6011',
	'6319': '6019',
	'6322': '6032',
	'6312': '6012',
	'6410': '6019',
	'6420': '6020',
	'6490': '6019',
	'6540': '6120',
	'6599': '6190',
	'6530': '6110',
	'6510': '6211',
	'6550': '6212',
	'6591': '6212',
	'6520': '6110',
	'6592': '7499',
	'6610': '6810',
	'6639': '7190',
	'6632': '7130',
	'6631': '7120',
	'6640': '6810',
	'6620': '6820',
	'6633': '7150',
	'6712': '6920',
	'6730': '6910',
	'6790': '6940',
	'6713': '6920',
	'6740': '6930',
	'6711': '6910',
	'6721': '6910',
	'6729': '6920',
	'6812': '7020',
	'6891': '7030',
	'6820': '7020',
	'6811': '7010',
	'6899': '7030',
	'6840': '7010',
	'6830': '7010',
	'6860': '7030',
	'6850': '7030',
	'6930': '7190',
	'6920': '7412',
	'6990': '7190',
	'6940': '7190',
	'6910': '7110',
	'7010': '7210',
	'7030': '7230',
	'7090': '7290',
	'7040': '7210',
	'7020': '7220',
	'7119': '7319',
	'7122': '7321',
	'7121': '7329',
	'7114': '7314',
	'7112': '7312',
	'7123': '7321',
	'7111': '7311',
	'7113': '7313',
	'7129': '7329',
	'7231': '7431',
	'7292': '7491',
	'7221': '7421',
	'7295': '7499',
	'7219': '7419',
	'7282': '7493',
	'7294': '7494',
	'7279': '7480',
	'7211': '7411',
	'7239': '7439',
	'7291': '7470',
	'7269': '7460',
	'7299': '7499',
	'7261': '7460',
	'7222': '7422',
	'7212': '7412',
	'7296': '7499',
	'7263': '7460',
	'7229': '7429',
	'7281': '7493',
	'7289': '7493',
	'7240': '7440',
	'7232': '7432',
	'7272': '7480',
	'7271': '7480',
	'7233': '7433',
	'7262': '7460',
	'7250': '7450',
	'7293': '7492',
	'7213': '7419',
	'7350': '7550',
	'7310': '7510',
	'7340': '7540',
	'7320': '7520',
	'7330': '7530',
	'7410': '7610',
	'7440': '7640',
	'7450': '7650',
	'7483': '7673',
	'7492': '8280',
	'7461': '7660',
	'7481': '7671',
	'7482': '7672',
	'7474': '7820',
	'7473': '7819',
	'7471': '7811',
	'7462': '7660',
	'7430': '7630',
	'7475': '7830',
	'7420': '7620',
	'7491': '7690',
	'7499': '7690',
	'7493': '531',
	'7472': '7812',
	'7513': '7710',
	'7514': '7710',
	'7520': '7720',
	'7511': '7710',
	'7590': '7790',
	'7512': '7710',
	'7519': '7710',
	'7610': '7910',
	'7690': '7990',
	'7620': '7929',
	'7640': '7990',
	'7630': '7921',
	'7721': '8023',
	'7729': '8029',
	'7725': '8029',
	'7713': '8012',
	'7723': '8024',
	'7719': '8019',
	'7724': '8024',
	'7711': '8011',
	'7712': '8012',
	'7722': '8029',
	'7830': '8021',
	'7851': '8132',
	'7810': '8110',
	'7820': '8022',
	'7852': '8131',
	'7840': '8120',
	'7950': '8250',
	'7940': '8240',
	'7930': '8230',
	'7960': '8240',
	'7980': '8270',
	'7920': '8220',
	'7910': '8210',
	'7970': '8260',
	'7990': '8290',
	'8031': '8313',
	'8022': '8312',
	'8012': '8311',
	'8092': '8319',
	'8091': '8319',
	'8032': '8313',
	'8021': '6130',
	'8099': '8319',
	'8011': '3726',
	'8029': '8312',
	'8093': '8319',
	'8119': '8329',
	'8190': '8390',
	'8111': '8321',
	'8232': '8434',
	'8210': '8410',
	'8241': '8441',
	'8242': '8442',
	'8250': '8492',
	'8233': '8439',
	'8231': '8431',
	'8235': '8439',
	'8293': '8491',
	'8294': '8499',
	'8299': '8499',
	'8221': '8420',
	'8292': '9190',
	'8222': '8420',
	'8291': '8491',
	'8234': '8432',
	'8236': '8433',
	'8312': '8512',
	'8313': '8513',
	'8311': '8511',
	'8314': '8514',
	'8316': '8516',
	'8390': '8590',
	'8340': '8540',
	'8350': '8550',
	'8322': '8520',
	'8370': '8570',
	'8321': '8520',
	'8323': '8520',
	'8315': '8515',
	'8360': '8560',
	'8330': '8530',
	'8429': '8720',
	'8419': '8712',
	'8415': '8712',
	'8413': '8712',
	'8411': '8711',
	'8412': '8712',
	'8421': '8720',
	'8414': '8712',
	'8525': '8825',
	'8510': '8810',
	'8521': '8821',
	'8529': '8829',
	'8523': '8823',
	'8522': '8822',
	'8524': '8824',
	'8630': '8920',
	'8610': '8910',
	'8640': '8920',
	'8660': '8910',
	'8650': '8932',
	'8620': '8920',
	'8720': '9020',
	'8790': '9090',
	'8760': '9060',
	'8750': '9050',
	'8732': '9032',
	'8731': '9031',
	'8710': '9010',
	'8770': '9070',
	'8740': '9040',
	'8890': '9190',
	'8810': '9110',
	'8830': '9230',
	'8820': '9120',
	'8920': '9220',
	'8911': '9210',
	'8949': '7499',
	'8930': '9290',
	'8990': '9290',
	'8919': '9210',
	'8913': '6190',
	'8942': '7499',
	'8912': '9210',
	'8941': '7499',
	'9000': '9300',
	'9131': '9431',
	'9124': '9424',
	'9190': '9490',
	'9126': '9427',
	'9123': '9423',
	'9125': '9425',
	'9121': '9421',
	'9132': '9432',
	'9122': '9422',
	'9110': '9410',
	'9220': '9520',
	'9210': '9510',
	'9300': '8600',
	'9440': '9630',
	'9411': '9611',
	'9422': '9622',
	'9412': '9612',
	'9429': '9629',
	'9413': '9613',
	'9421': '9621',
	'9430': '9629',
	'9419': '9619',
	'9520': '9720',
	'9510': '9710',
	'9600': '9800'
}

location = {
	'110221': '110114',
	'110224': '110115',
	'110227': '110116',
	'110226': '110117',
	'120222': '120114',
	'120224': '120115',
	'130282': '130207',
	'130221': '130208',
	'130230': '130209',
	'142401': '140702',
	'142421': '140721',
	'142422': '140722',
	'142423': '140723',
	'142424': '140724',
	'142427': '140725',
	'142429': '140726',
	'142431': '140728',
	'142433': '140729',
	'142402': '140781',
	'142724': '140821',
	'142725': '140822',
	'142729': '140823',
	'142727': '140824',
	'142726': '140825',
	'142731': '140826',
	'142733': '140827',
	'142730': '140828',
	'142732': '140829',
	'142723': '140830',
	'142702': '140881',
	'142703': '140882',
	'142222': '140921',
	'142223': '140922',
	'142225': '140923',
	'142226': '140924',
	'142227': '140925',
	'142228': '140926',
	'142229': '140927',
	'142230': '140928',
	'142231': '140929',
	'142232': '140930',
	'142233': '140931',
	'142234': '140932',
	'142202': '140981',
	'142621': '141021',
	'142622': '141022',
	'142623': '141023',
	'142625': '141024',
	'142627': '141025',
	'142628': '141026',
	'142629': '141027',
	'142630': '141028',
	'142631': '141029',
	'142633': '141030',
	'142635': '141031',
	'142634': '141032',
	'142636': '141034',
	'142602': '141081',
	'142603': '141082',
	'142302': '141102',
	'142322': '141121',
	'142323': '141122',
	'142325': '141123',
	'152801': '141124',
	'142327': '141125',
	'142328': '141126',
	'142329': '141127',
	'142330': '141128',
	'142332': '141129',
	'142333': '141130',
	'142301': '141181',
	'142303': '141182',
	'152322': '150521',
	'152323': '150522',
	'152324': '150523',
	'152325': '150524',
	'152326': '150525',
	'152327': '150526',
	'152302': '150581',
	'152722': '150621',
	'152723': '150622',
	'152724': '150623',
	'152725': '150624',
	'152726': '150625',
	'152727': '150626',
	'152728': '150627',
	'152101': '150702',
	'152122': '150721',
	'152123': '150722',
	'152127': '150723',
	'152128': '150724',
	'152131': '150725',
	'152130': '150726',
	'152129': '150727',
	'152102': '150781',
	'152104': '150782',
	'152103': '150783',
	'152106': '150784',
	'152105': '150785',
	'362502': '150802',
	'152822': '150821',
	'152823': '150822',
	'152824': '150823',
	'152825': '150824',
	'152826': '150825',
	'152827': '150826',
	'152601': '150902',
	'152624': '150921',
	'152625': '150922',
	'152626': '150923',
	'152627': '150924',
	'152629': '150925',
	'152630': '150926',
	'152631': '150927',
	'152632': '150928',
	'152634': '150929',
	'152602': '150981',
	'220625': '220605',
	'230106': '230110',
	'230121': '230111',
	'230181': '230112',
	'232324': '231221',
	'232325': '231222',
	'232326': '231223',
	'232330': '231224',
	'232331': '231225',
	'232332': '231226',
	'232302': '231281',
	'232303': '231282',
	'232304': '231283',
	'310229': '310118',
	'310226': '310120',
	'320121': '320115',
	'320123': '320116',
	'320283': '320205',
	'320323': '320312',
	'320483': '320412',
	'320584': '320509',
	'320683': '320612',
	'320882': '320803',
	'320821': '320804',
	'320928': '320903',
	'321027': '321003',
	'321088': '321012',
	'321121': '321112',
	'321321': '321311',
	'330181': '330109',
	'330184': '330110',
	'330227': '330212',
	'330721': '330703',
	'330821': '330803',
	'332522': '331121',
	'332526': '331122',
	'332527': '331123',
	'332528': '331124',
	'332523': '331125',
	'332525': '331126',
	'332529': '331127',
	'332502': '331181',
	'342622': '340124',
	'342601': '340181',
	'342623': '340225',
	'342625': '340522',
	'342626': '340523',
	'342401': '341502',
	'342422': '341521',
	'342423': '341522',
	'342425': '341523',
	'342426': '341524',
	'342427': '341525',
	'341223': '341621',
	'341224': '341622',
	'341227': '341623',
	'342901': '341702',
	'342921': '341721',
	'342922': '341722',
	'342923': '341723',
	'342501': '341802',
	'342522': '341821',
	'342523': '341822',
	'342529': '341823',
	'342531': '341824',
	'342530': '341825',
	'342502': '341881',
	'350321': '350304',
	'352225': '350921',
	'352227': '350922',
	'352228': '350923',
	'352229': '350924',
	'352230': '350925',
	'352231': '350926',
	'352202': '350981',
	'352203': '350982',
	'362401': '360802',
	'362421': '360821',
	'362422': '360822',
	'362423': '360823',
	'362424': '360824',
	'362425': '360825',
	'362426': '360826',
	'362427': '360827',
	'362428': '360828',
	'362429': '360829',
	'362430': '360830',
	'362402': '360881',
	'362201': '360902',
	'362226': '360921',
	'362227': '360922',
	'362228': '360923',
	'362229': '360924',
	'362232': '360925',
	'362233': '360926',
	'362202': '360981',
	'362203': '360982',
	'362204': '360983',
	'142326': '361002',
	'362522': '361021',
	'362523': '361022',
	'362524': '361023',
	'362525': '361024',
	'362526': '361025',
	'362527': '361026',
	'362528': '361027',
	'362529': '361028',
	'362531': '361029',
	'362532': '361030',
	'362301': '361102',
	'362321': '361121',
	'362322': '361122',
	'362323': '361123',
	'362324': '361124',
	'362325': '361125',
	'362326': '361126',
	'362329': '361127',
	'362331': '361129',
	'362334': '361130',
	'362302': '361181',
	'370123': '370113',
	'372321': '371621',
	'372323': '371622',
	'372324': '371623',
	'372325': '371624',
	'372328': '371625',
	'372330': '371626',
	'372925': '371722',
	'372924': '371723',
	'372926': '371724',
	'372928': '371725',
	'372929': '371726',
	'372923': '371727',
	'372930': '371728',
	'411123': '411103',
	'412721': '411621',
	'412722': '411622',
	'412723': '411623',
	'412728': '411624',
	'412726': '411625',
	'412727': '411626',
	'412724': '411627',
	'412725': '411628',
	'412702': '411681',
	'412824': '411721',
	'412825': '411722',
	'412827': '411723',
	'412829': '411724',
	'412821': '411725',
	'412822': '411726',
	'412826': '411727',
	'412823': '411728',
	'412828': '411729',
	'410881': '419001',
	'420521': '420506',
	'420983': '421381',
	'430122': '430112',
	'430402': '430405',
	'430403': '430406',
	'430411': '430408',
	'432501': '431302',
	'432522': '431321',
	'432524': '431322',
	'432502': '431381',
	'432503': '431382',
	'440181': '440113',
	'440182': '440114',
	'440221': '440205',
	'440421': '440403',
	'440506': '440512',
	'440582': '440513',
	'440583': '440515',
	'440682': '440605',
	'440681': '440606',
	'440683': '440607',
	'440684': '440608',
	'440782': '440705',
	'441381': '441303',
	'450106': '450107',
	'450121': '450109',
	'452126': '450123',
	'452127': '450124',
	'452124': '450125',
	'452123': '450126',
	'452122': '450127',
	'452223': '450223',
	'452227': '450224',
	'452229': '450225',
	'452228': '450226',
	'452622': '451021',
	'452623': '451022',
	'452624': '451023',
	'452625': '451024',
	'452626': '451025',
	'452627': '451026',
	'452628': '451027',
	'452629': '451028',
	'452630': '451029',
	'452632': '451030',
	'452631': '451031',
	'452424': '451121',
	'452427': '451122',
	'452428': '451123',
	'452725': '451221',
	'452726': '451222',
	'452727': '451223',
	'452728': '451224',
	'452723': '451225',
	'452724': '451226',
	'452729': '451227',
	'452730': '451228',
	'452731': '451229',
	'452702': '451281',
	'452231': '451321',
	'452224': '451322',
	'452225': '451323',
	'452230': '451324',
	'452201': '451381',
	'452128': '451421',
	'452132': '451422',
	'452133': '451423',
	'452130': '451424',
	'452131': '451425',
	'452101': '451481',
	'460104': '460105',
	'460004': '460107',
	'460037': '460321',
	'460038': '460322',
	'460039': '460323',
	'460001': '469001',
	'460002': '469002',
	'460003': '469003',
	'460005': '469005',
	'460006': '469006',
	'460007': '469007',
	'460025': '469021',
	'460026': '469022',
	'460027': '469023',
	'460028': '469024',
	'460030': '469025',
	'460031': '469026',
	'460033': '469027',
	'460034': '469028',
	'460035': '469029',
	'460036': '469030',
	'500239': '500114',
	'500221': '500115',
	'500381': '500116',
	'500382': '500117',
	'500383': '500118',
	'500384': '500119',
	'510125': '510114',
	'510123': '510115',
	'513021': '510903',
	'510902': '510904',
	'513822': '511421',
	'513823': '511422',
	'513824': '511423',
	'513825': '511424',
	'513826': '511425',
	'511522': '511503',
	'513022': '511722',
	'513023': '511723',
	'513029': '511724',
	'513030': '511725',
	'513002': '511781',
	'513122': '511803',
	'513123': '511822',
	'513124': '511823',
	'513125': '511824',
	'513126': '511825',
	'513127': '511826',
	'513128': '511827',
	'513721': '511921',
	'513722': '511922',
	'513723': '511923',
	'513921': '512021',
	'513922': '512022',
	'513902': '512081',
	'520202': '520222',
	'522526': '520421',
	'522527': '520422',
	'522529': '520423',
	'522528': '520424',
	'522530': '520425',
	'522422': '520521',
	'522423': '520522',
	'522424': '520523',
	'522425': '520524',
	'522426': '520525',
	'522427': '520526',
	'522428': '520527',
	'522230': '520603',
	'522222': '520621',
	'522223': '520622',
	'522224': '520623',
	'522225': '520624',
	'522226': '520625',
	'522227': '520626',
	'522228': '520627',
	'522229': '520628',
	'530121': '530114',
	'533022': '530521',
	'533023': '530522',
	'533024': '530523',
	'533025': '530524',
	'532122': '530621',
	'532123': '530622',
	'532124': '530623',
	'532125': '530624',
	'532126': '530625',
	'532127': '530626',
	'532128': '530627',
	'532129': '530628',
	'532130': '530629',
	'532131': '530630',
	'533222': '530722',
	'533223': '530723',
	'533224': '530724',
	'532701': '530802',
	'532723': '530822',
	'532724': '530823',
	'532725': '530824',
	'532726': '530825',
	'532727': '530826',
	'532728': '530827',
	'532729': '530828',
	'532730': '530829',
	'533522': '530921',
	'533524': '530923',
	'533525': '530924',
	'533526': '530925',
	'533527': '530926',
	'533528': '530927',
	'532522': '532503',
	'622626': '532601',
	'610121': '610116',
	'610221': '610204',
	'610321': '610304',
	'612722': '610821',
	'612723': '610822',
	'612724': '610823',
	'612725': '610824',
	'612726': '610825',
	'612727': '610826',
	'612728': '610827',
	'612729': '610828',
	'612730': '610829',
	'612731': '610830',
	'612732': '610831',
	'612422': '610921',
	'612423': '610922',
	'612424': '610923',
	'612425': '610924',
	'612426': '610925',
	'612427': '610926',
	'612428': '610927',
	'612429': '610928',
	'612430': '610929',
	'612501': '611002',
	'612522': '611021',
	'612523': '611022',
	'612524': '611023',
	'612525': '611024',
	'612526': '611025',
	'612527': '611026',
	'622301': '620602',
	'622322': '620621',
	'622323': '620622',
	'622326': '620623',
	'622201': '620702',
	'622222': '620721',
	'622223': '620722',
	'622224': '620723',
	'622225': '620724',
	'622226': '620725',
	'622701': '620802',
	'622722': '620821',
	'622723': '620822',
	'622724': '620823',
	'622725': '620824',
	'622726': '620825',
	'622727': '620826',
	'622102': '620902',
	'622123': '620921',
	'622124': '620923',
	'622125': '620924',
	'622101': '620981',
	'622103': '620982',
	'622801': '621002',
	'622821': '621021',
	'622822': '621022',
	'622823': '621023',
	'622824': '621024',
	'622825': '621025',
	'622826': '621026',
	'622827': '621027',
	'622424': '621121',
	'622425': '621122',
	'622426': '621123',
	'622427': '621124',
	'622428': '621125',
	'622429': '621126',
	'622621': '621202',
	'532621': '621222',
	'622623': '621223',
	'622625': '621224',
	'622627': '621225',
	'622628': '621226',
	'622630': '621227',
	'622629': '621228',
	'632124': '630122',
	'632125': '630123',
	'640382': '640181',
	'640223': '640205',
	'642223': '640422',
	'642224': '640423',
	'642225': '640424',
	'642226': '640425',
	'640322': '640521',
	'642222': '640522',
	'652303': '650109',
	'654101': '654002',
	'654001': '654003',
	'654121': '654021',
	'654122': '654022',
	'654123': '654023',
	'654124': '654024',
	'654125': '654025',
	'654126': '654026',
	'654127': '654027',
	'654128': '654028'
}

##
## load data
##

dtype = {'id': str, 'loccode': np.float}

# basic info
print('loading basic info')
basic = pd.concat([pd.read_csv(fn, dtype=dtype)[cols_basic].rename(cols_basic, axis=1) for fn in glob('original/Basic_Information-*.txt')], sort=True)
basic['year'] = basic['year'].apply(lambda s: s[:4]).astype(np.int, errors='ignore')
basic['loccode'] = basic['loccode'].fillna(0).astype(np.int).astype(str) # BAD

# goods info
print('loading goods and services info')
goods = pd.concat([pd.read_csv(fn, dtype=dtype)[cols_goods].rename(cols_goods, axis=1) for fn in glob('original/Goods_Service-*.txt')], sort=True)
goods['year'] = goods['year'].apply(lambda s: s[:4]).astype(np.int, errors='ignore')
goods = goods[goods['code']==0]

# tax info
print('loading tax and finance info')
taxes = pd.concat([pd.read_csv(fn, dtype=dtype)[cols_taxes].rename(cols_taxes, axis=1) for fn in glob('original/Taxation_Finance-*.txt')], sort=True)
taxes['year'] = taxes['year'].apply(lambda s: s[:4]).astype(np.int, errors='ignore')

##
## fixes
##

# location fix
basic['loccode'] = basic['loccode'].where(basic['year']>2011, basic['loccode'].replace(location))

# industry fix
ind0 = lambda s: s[1:] if type(s) is str else np.nan
basic['industry_a'] = basic['industry_a'].apply(ind0)
basic['industry_b'] = basic['industry_b'].apply(ind0)
basic['industry'] = basic['industry_a'].fillna(basic['industry_b'].replace(industry))

# employee fix
taxes['employees'].fillna(0.5*(taxes['employees_start']+taxes['employees_end']))

##
## merge
##

print('merging datasets')

index = ['firmid', 'year']
firms = pd.concat([
    basic.dropna(subset=index).set_index(index),
    goods.dropna(subset=index).set_index(index),
    taxes.dropna(subset=index).set_index(index)
], axis=1).reset_index()

##
## columns
##

# total sales
firms['sales'] = firms['sales_va'] + firms['sales_nova'] + firms['sales_exp']

##
## selections
##

firms = firms[firms['loccode']!='0']
firms = firms.dropna(subset=['ee', 'sales', 'sales_net', 'income_main'])
firms = firms[firms['employees']>0]
for col in ['ee', 'sales_net', 'income_main', 'cost_oper', 'asset_start', 'asset_end']:
	firms = firms[firms[col]>=0]
